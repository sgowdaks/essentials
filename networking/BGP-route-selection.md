BGP doesn't just look at the shortest physical path (like OSPF does); it looks at **Path Attributes (PAs)** to decide which way is "best" based on business logic and policy.

Think of Path Attributes as the **metadata** attached to every route.

---

## 1. The Categories of Path Attributes

Not all attributes are created equal. BGP categorizes them based on whether every router must understand them and whether they must be passed on to the next neighbor.

| Category | Description | Examples |
| --- | --- | --- |
| **Well-Known Mandatory** | Every BGP router **must** recognize these, and they **must** be included in every update. | AS-Path, Next-Hop, Origin |
| **Well-Known Discretionary** | Every router recognizes them, but they are **optional** to include. | Local Preference, Atomic Aggregate |
| **Optional Transitive** | Routers might not recognize them, but they **must pass them on** to the next peer. | Community, Aggregator |
| **Optional Non-Transitive** | If a router doesn't recognize it, it just **ignores/drops** it and doesn't pass it on. | MED (Multi-Exit Discriminator) |

---

## 2. The Heavy Hitters (The Attributes You’ll Use Most)

### A. AS-Path (Well-Known Mandatory)

This is a list of every Autonomous System (AS) the route has traveled through.

* **Purpose:** Loop prevention. If a router sees its own AS number in the list, it drops the update.
* **Decision:** BGP prefers the **shortest** AS-Path.

### B. Next-Hop (Well-Known Mandatory)

This is the IP address used to reach the destination.

* **Crucial Rule:** In eBGP, the Next-Hop changes to the IP of the router sending the update. In iBGP, the Next-Hop **does not change** by default (this is why we often need the `next-hop-self` command).

### C. Local Preference (Well-Known Discretionary)

This tells routers **inside** your AS which path to take to exit the AS.

* **Scope:** Stays within your AS (iBGP). It is never sent to eBGP peers.
* **Decision:** Higher is better (Default is usually 100).

### D. MED - Multi-Exit Discriminator (Optional Non-Transitive)

This is used to tell an **adjacent AS** which entry point into *your* network is preferred.

* **Scope:** Sent to eBGP peers to influence their incoming traffic.
* **Decision:** Lower is better (think of it as "cost").

---

## 3. The BGP Best Path Selection Algorithm

When a router receives multiple paths to the same destination, it runs this "tie-breaker" list in order. As soon as one path wins a step, the process stops.

1. **Weight** (Cisco Proprietary): Higher is preferred. (Local to the router only).
2. **Local Preference**: Higher is preferred. (Internal to the AS).
3. **Locally Originated**: Routes generated by the router itself (`network` command) are preferred over learned routes.
4. **AS-Path**: Shortest list wins.
5. **Origin Type**: IGP (i) is preferred over Exterior (e) or Incomplete (?).
6. **MED**: Lowest value wins.
7. **Neighbor Type**: eBGP paths are preferred over iBGP paths.
8. **IGP Metric to Next-Hop**: The route with the shortest internal path (OSPF/IS-IS cost) to reach the BGP Next-Hop wins.

---

## 4. Understanding Route Selection (Policy-Based Routing)

"Route Selection" isn't just a passive calculation; it’s how you, the engineer, manipulate those attributes to control traffic.

* **Influencing Outbound Traffic:** You use **Local Preference**. If you have two ISPs and want to use ISP-A for all traffic, you set a higher Local Pref for routes coming from ISP-A.
* **Influencing Inbound Traffic:** This is harder because you're trying to control someone else's routers. You usually use **AS-Path Prepending** (making your AS-Path look artificially longer to certain neighbors) or **MED**.

### The Route Map (The Tool)

To change these attributes, we use **Route Maps**. Think of a Route Map like an `if/then` statement:

* *Match* a specific prefix (e.g., 8.8.8.0/24).
* *Set* an attribute (e.g., set Local-Preference to 200).

---

## 5. Summary Note

In your **Seattle -> Colorado -> Chicago -> New York** example:

* **OSPF** ensures Seattle can "see" New York (the Next-Hop).
* **BGP Path Attributes** (like AS-Path) tell Seattle if the path through New York is better than a path through a different border router (say, one in Miami).
* **Route Reflectors** ensure that these Path Attributes are passed from New York to Seattle without needing a direct physical or logical connection between them.

---
# Understanding path selection algorithm with senarious. 

This is the "BGP Beauty Contest." To understand it, let's imagine a single router—we'll call it **Seattle**—that is trying to reach **Azure**.

Seattle receives **8 different "offers"** (paths) for the same Azure prefix. BGP will walk through the list one by one. As soon as a path "loses" a round, it is eliminated.

---

### The Scenario: Seattle's 8 Options

#### 1. Weight (Cisco Proprietary)

* **The Logic:** This is your "I say so" button. It never leaves the router.
* **The Example:** Seattle has two physical cables. You configure `neighbor [IP] weight 500` on Cable A and `300` on Cable B.
* **Winner:** **Cable A** wins immediately. The rest of the list is ignored. If weights are equal (default is 0), move to step 2.

#### 2. Local Preference

* **The Logic:** How the whole company (AS) feels about an exit.
* **The Example:** Your boss says, "We prefer the ExpressRoute over the VPN." You set Local Pref to **200** on the ExpressRoute and **100** on the VPN.
* **Winner:** **ExpressRoute.** All routers in the AS will now prefer this exit. If equal, move to step 3.

#### 3. Locally Originated

* **The Logic:** "I know this place because it's in my backyard."
* **The Example:** Seattle learns a route to Azure from New York, but Seattle *also* has a direct connection to an Azure edge node and uses the `network` command to claim it.
* **Winner:** **Seattle's own route.** It trusts itself more than gossip from New York.

#### 4. AS-Path Length

* **The Logic:** The "Shortest distance between two points."
* **The Example:** * Path A: `(AS 100, AS 8075)` — (2 hops)
* Path B: `(AS 200, AS 300, AS 8075)` — (3 hops)


* **Winner:** **Path A.** If lengths are the same, move to step 5.

#### 5. Origin Type

* **The Logic:** How did this route enter BGP? (Legacy attribute).
* **The Ranking:** `IGP (i)` > `EGP (e)` > `Incomplete (?)`.
* **The Example:** If one path was cleanly added via a `network` command (i) and the other was "redistributed" from a messy static route (?), the **IGP** one wins.

#### 6. MED (Multi-Exit Discriminator)

* **The Logic:** A suggestion from your neighbor (Azure) on which door to use.
* **The Example:** Azure has two links to you. Azure sends a **MED of 10** on Link 1 and **MED of 20** on Link 2.
* **Winner:** **Link 1** (Lowest wins). Note: This only works if both paths come from the *same* neighbor AS.

#### 7. Neighbor Type (eBGP vs iBGP)

* **The Logic:** "Information from a stranger is better than a rumor from a friend."
* **The Example:** Seattle hears about Azure from an eBGP neighbor (direct connection) and from an iBGP neighbor (New York).
* **Winner:** **eBGP.** It’s always better to take the exit right in front of you than to carry the packet across your own network.

#### 8. IGP Metric to Next-Hop

* **The Logic:** "Hot Potato Routing."
* **The Example:** Both New York and LA are advertising Azure with identical attributes.
* OSPF cost to New York: **100**
* OSPF cost to LA: **20**


* **Winner:** **LA.** Seattle wants the packet out of its hands as fast as possible.

---

### Summary Table for Quick Reference

| Attribute | Winner | Scope |
| --- | --- | --- |
| **Weight** | Higher | Local Router only |
| **Local Pref** | Higher | Entire AS |
| **Local Orig** | Self | Local Router |
| **AS-Path** | Shortest | Global |
| **Origin** | IGP > ? | Global |
| **MED** | Lower | Between two ASns |
| **eBGP > iBGP** | eBGP | Local Router |
| **IGP Metric** | Lower | Internal Network |

### A Quick Trick to Remember

Most real-world BGP issues are decided at **Local Preference** (Step 2), **AS-Path** (Step 4), or **IGP Metric** (Step 8). If you know those three, you can solve 90% of BGP routing problems.
